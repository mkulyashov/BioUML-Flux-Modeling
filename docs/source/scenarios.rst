Доступные сценарии
==================

В конвейере реконструкции метаболических моделей реализовано три основных
сценария использования, отличающихся типом входных данных и тем,
какие инструменты реконструкции используются в одном запуске.

* **Сценарий I** — реконструкция моделей из сырых прочтений
  с использованием полного конвейера; в каждом запуске используется один
  выбранный инструмент реконструкции.
* **Сценарий II** — реконструкция моделей из уже существующей сборки генома
  или готовой аннотации, также по одному выбранному инструменту реконструкции.
* **Сценарий III** — реконструкция моделей из уже существующей сборки генома
  или готовой аннотации с одновременным использованием трёх инструментов
  реконструкции и последующим формированием сравнительного отчёта Memote
  по всем полученным моделям.

Ниже описаны все восемь сценариев, реализующих эти варианты.


Сценарий I: полная реконструкция из сырых прочтений
----------------------------------------------------

В этом сценарии конвейер стартует от сырых прочтений (обычно парных Illumina)
и последовательно выполняет:

* предобработку и контроль качества чтений;
* сборку генома;
* аннотацию генома;
* реконструкцию метаболической модели выбранным инструментом;
* обогащение модели путями;
* оценку качества модели (memote);
* построение метаболических карт (BioEMMA).

Общий формат входных параметров для сценариев «из прочтений»:

* **Входные чтения R1** (``reads1``) — файл FASTQ с прочтениями R1.
* **Входные чтения R2** (``reads2``) — файл FASTQ с прочтениями R2.
* **Список путей для метаболических карт** (``pathways``) — необязательный параметр;
  если не задан, используется значение по умолчанию внутри BioEMMA.

На уровне WDL все сценарии используют единое имя workflow:
``ModelReconstructionPipeline``.

Полный конвейер (gapseq, из сырых прочтений)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Вариант:** полный конвейер реконструкции с использованием gapseq  
**WDL-файл:** ``gapseq_from_sequences.wdl``  
**Workflow:** ``ModelReconstructionPipeline``

Описание
^^^^^^^^

Конвейер строит модель с использованием **gapseq** в качестве основного
инструмента реконструкции. Внутри workflow последовательно вызываются:

* ``fastp`` — очистка чтений;
* ``fastqc1`` и ``fastqc2`` — контроль качества по R1 и R2;
* ``spades`` — сборка генома;
* ``prokka`` — аннотация сборки;
* ``gapseq`` — первичная реконструкция метаболической модели;
* ``cobramod`` — обогащение модели путями и аннотациями;
* ``memote`` — оценка качества модели;
* ``bioemma`` — построение метаболических карт (параметр ``pathways`` передаётся из входа).

Основные входы/выходы
^^^^^^^^^^^^^^^^^^^^^

* Вход: сырые чтения (``reads1``, ``reads2``) и опционально список путей (``pathways``).
* Выход: по крайней мере одна модель (SBML), отчёт memote и файлы с метаболическими картами.


Полный конвейер (ModelSEED, из сырых прочтений)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Вариант:** полный конвейер реконструкции с использованием ModelSEED  
**WDL-файл:** ``modelseed_from_sequences.wdl``  
**Workflow:** ``ModelReconstructionPipeline``

Описание
^^^^^^^^

Конвейер аналогичен варианту с gapseq, но в качестве инструмента реконструкции
используется **ModelSEED**. Внутри workflow вызываются:

* ``fastp`` — очистка чтений;
* ``fastqc1`` и ``fastqc2`` — контроль качества;
* ``spades`` — сборка генома;
* ``prokka`` — аннотация;
* ``modelseed`` — реконструкция модели по данным ModelSEED;
* ``cobramod`` — обогащение модели;
* ``memote`` — оценка качества;
* ``bioemma`` — построение метаболических карт.

Основные входы/выходы
^^^^^^^^^^^^^^^^^^^^^

* Вход: ``reads1``, ``reads2``, опционально ``pathways``.
* Выход: модель, отчёт memote, метаболические карты.


Полный конвейер (Bactabolize, из сырых прочтений)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Вариант:** полный конвейер реконструкции с использованием Bactabolize  
**WDL-файл:** ``bactabolize_from_sequences.wdl``  
**Workflow:** ``ModelReconstructionPipeline``

Описание
^^^^^^^^

Этот конвейер реализует полный путь от сырых чтений до штамм-специфической
метаболической модели, построенной с помощью **Bactabolize**. Внутри workflow
последовательно выполняются:

* ``fastp`` — предобработка и триммирование чтений; основной поток конвейера.
* ``fastqc1`` и ``fastqc2`` — контроль качества чтений для R1 и R2.
* ``spades`` — сборка генома.
* ``prokka`` — аннотация полученной сборки.
* ``bactabolize`` — реконструкция штамм-специфичной черновой модели
  на основе референсной модели и референсных последовательностей.
* ``cobramod`` — дополнительное «насыщение» модели путями и аннотациями.
* ``memote`` — построение отчёта по качеству итоговой модели.
* ``bioemma`` — генерация метаболических карт на основе полученной модели
  (список путей передаётся параметром ``pathways``, при его отсутствии
  используется значение по умолчанию внутри workflow).

Основные входы/выходы
^^^^^^^^^^^^^^^^^^^^^

* Вход:

  - ``reads1``, ``reads2`` — сырые чтения в формате FASTQ;
  - ``ref_genes_fp`` — Файл генов из референсной (пангеномной) модели;
  - ``ref_proteins_fp`` — Файл аминокислотные последовательности белков референсной (пангеномной) модели;
  - ``ref_proteins_fp`` — пан-модель используемая Bactabolize для генерации штамм-специфичной модели;
  - ``pathways`` (опционально) — список путей для BioEMMA.

* Выход:

  - итоговая модель (SBML/файл, возвращаемый задачей ``cobramod``);
  - HTML-отчёт memote;
  - набор файлов с метаболическими картами (архив/каталог BioEMMA).


Сценарий II: реконструкция из готовой сборки или аннотации
-----------------------------------------------------------

В этом сценарии конвейер стартует не с сырых прочтений, а с уже подготовленного
файла генома (сборка и/или аннотация). Этапы предобработки и сборки либо уже
выполнены, либо не нужны.

Общий формат входных параметров для сценариев «из аннотации/сборки»:

* **Готовый геномный файл** (``annotation``) — входной файл, который передаётся
  в инструменты реконструкции как основной вход (обычно это сборка в формате
  FASTA или файл, совместимый с соответствующим инструментом).
* **Список путей для метаболических карт** (``pathways``) — необязательный параметр
  для BioEMMA.

Конвейер от сборки/аннотации (gapseq)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Вариант:** реконструкция из готовой сборки/аннотации с использованием gapseq  
**WDL-файл:** ``gapseq_from_annotation.wdl``  
**Workflow:** ``ModelReconstructionPipeline``

Описание
^^^^^^^^

Конвейер принимает готовый геномный файл (``annotation``) и строит модель
с помощью **gapseq**, а затем обогащает и анализирует её:

* ``gapseq`` — реконструкция модели;
* ``cobramod`` — обогащение модели;
* ``memote`` — оценка качества;
* ``bioemma`` — построение метаболических карт (использует ``pathways``, если задан).

Основные входы/выходы
^^^^^^^^^^^^^^^^^^^^^

* Вход: ``annotation``, опционально ``pathways``.
* Выход: модель, отчёт memote, карты BioEMMA.


Конвейер от сборки/аннотации (ModelSEED)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Вариант:** реконструкция из готовой сборки/аннотации с использованием ModelSEED  
**WDL-файл:** ``modelseed_from_annotation.wdl``  
**Workflow:** ``ModelReconstructionPipeline``

Описание
^^^^^^^^

Здесь реконструкция выполняется с помощью **ModelSEED**, при этом:

* ``modelseed`` — первичная реконструкция модели;
* ``cobramod`` — обогащение;
* ``memote`` — оценка качества;
* ``bioemma`` — метаболические карты.

Основные входы/выходы
^^^^^^^^^^^^^^^^^^^^^

* Вход: ``annotation``, опционально ``pathways``.
* Выход: модель, отчёт memote, метаболические карты.


Конвейер от сборки/аннотации (Bactabolize)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Вариант:** реконструкция из готовой сборки/аннотации с использованием Bactabolize  
**WDL-файл:** ``bactabolize_from_annotation.wdl``  
**Workflow:** ``ModelReconstructionPipeline``

Описание
^^^^^^^^

В этом варианте конвейер стартует не с сырых прочтений, а с уже готовой
сборки или аннотации генома (вход ``annotation``). Далее:

* ``bactabolize`` — реконструкция штамм-специфичной черновой модели
  на основе референсной модели и референсных последовательностей.
* ``cobramod`` — обогащение черновой модели путями и аннотациями.
* ``memote`` — расчёт и сохранение отчёта о качестве модели.
* ``bioemma`` — автоматическая генерация метаболических карт по итоговой модели.

Основные входы/выходы
^^^^^^^^^^^^^^^^^^^^^

* Вход:

  - ``annotation`` — файл сборки/аннотации, используемый Bactabolize;
  - ``ref_genes_fp`` — Файл генов из референсной (пангеномной) модели;
  - ``ref_proteins_fp`` — Файл аминокислотные последовательности белков референсной (пангеномной) модели;
  - ``ref_proteins_fp`` — пан-модель используемая Bactabolize для генерации штамм-специфичной модели;
  - ``pathways`` (опционально) — список путей для BioEMMA.

* Выход:

  - итоговая модель (после ``cobramod``);
  - отчёт memote;
  - файлы метаболических карт (BioEMMA).


Сценарий III: многовариантная реконструкция и сравнительный анализ
-------------------------------------------------------------------

В этом сценарии на одних и тех же исходных данных выполняется **одновременная**
реконструкция несколькими инструментами (три из четырёх доступных в конвейере),
после чего для всех полученных моделей строятся отчёты memote и, при необходимости,
метаболические карты.

Такой сценарий реализован в двух вариантах:

* из сырых прочтений (полный путь от reads до модели),
* из готовой сборки/аннотации.

Многовариантная реконструкция (из сырых прочтений)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Вариант:** одновременная реконструкция тремя инструментами из сырых прочтений  
**WDL-файл:** ``bactabolize_gapseq_modelseed_from_sequences.wdl``  
**Workflow:** ``ModelReconstructionPipeline``

Описание
^^^^^^^^

Этот workflow реализует полный путь от сырых чтений до **трёх** отдельных
метаболических моделей, полученных разными инструментами, с последующей
оценкой и визуализацией. Общие шаги:

* ``fastp`` — предобработка и триммирование чтений (основной поток).
* ``fastqc1`` и ``fastqc2`` — QC R1/R2 (боковые ветки для отчётов).
* ``spades`` — сборка генома.
* ``prokka`` — аннотация сборки.

Далее конвейер ветвится на три независимые реконструкции:

* ``bactabolize`` — первая модель.
* ``gapseq`` — вторая модель.
* ``modelseed`` — третья модель.

Для каждой полученной модели выполняются шаги постобработки:

* ``cobramod`` — обогащение модели путями.
* ``memote`` — оценка качества модели и формирование отчёта.
* ``bioemma`` — построение метаболических карт (список путей задаётся ``pathways``,
  при отсутствии используется значение по умолчанию).

Основные входы/выходы
^^^^^^^^^^^^^^^^^^^^^

* Вход:

  - ``reads1``, ``reads2`` — сырые FASTQ;
  - ``ref_genes_fp`` — Файл генов из референсной (пангеномной) модели;
  - ``ref_proteins_fp`` — Файл аминокислотные последовательности белков референсной (пангеномной) модели;
  - ``ref_proteins_fp`` — пан-модель используемая Bactabolize для генерации штамм-специфичной модели;
  - ``pathways`` (опционально) — список путей для BioEMMA.

* Выход:

  - три модели (Bactabolize, gapseq, ModelSEED);
  - три отчёта memote для каждой модели;
  - сравнительный отчёт memote между 3 реконструкциями;
  - набор метаболических карт по каждой модели (или общий архив, в зависимости
    от настроек BioEMMA).


Многовариантная реконструкция (из аннотации/сборки)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Вариант:** одновременная реконструкция тремя инструментами из готовой аннотации  
**WDL-файл:** ``bactabolize_gapseq_modelseed_from_annotation.wdl``  
**Workflow:** ``ModelReconstructionPipeline``

Описание
^^^^^^^^

В этом варианте конвейер стартует с уже готовой сборки/аннотации (вход
``annotation``) и параллельно строит три модели:

* ``bactabolize`` — модель на основе референсной пан-модели.
* ``gapseq`` — модель на основе предсказанных путей/транспортеров.
* ``modelseed`` — модель, реконструированная через инфраструктуру ModelSEED.

Для каждой из моделей выполняется единый набор шагов анализа:

* ``cobramod`` — дополнительное обогащение моделью путей.
* ``memote`` — построение отчётов качества модели.
* ``bioemma`` — генерация метаболических карт по каждой модели.

Основные входы/выходы
^^^^^^^^^^^^^^^^^^^^^

* Вход:

  - ``annotation`` — файл сборки/аннотации генома;
  - ``ref_genes_fp`` — Файл генов из референсной (пангеномной) модели;
  - ``ref_proteins_fp`` — Файл аминокислотные последовательности белков референсной (пангеномной) модели;
  - ``ref_proteins_fp`` — пан-модель используемая Bactabolize для генерации штамм-специфичной модели;
  - ``pathways`` (опционально) — список путей для BioEMMA.

* Выход:

  - три итоговые модели;
  - три отчёта memote для каждой модели;
  - сравнительный отчёт memote между 3 реконструкциями;
  - набор карт, сгенерированных BioEMMA (один или несколько архивов).
